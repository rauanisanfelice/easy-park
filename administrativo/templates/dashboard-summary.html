{% extends 'template-administrativo.html' %}
{% load static %}
{% load bootstrap4 %}

{% comment %} BLOCO DE TITULO DO SITE {% endcomment %}
{% block title %}Dashboards{% endblock %}

{% comment %} BLOCO HEAD {% endcomment %}
{% block head %}{% endblock %}

{% comment %} BLOCO DO CORPO DO HTML {% endcomment %}
{% block body %}
    {% comment %} MENSAGENS DE RETORNO {% endcomment %}
    {% if error %}
    <div class="alert alert-danger" role="alert">
        <h5><i class="icon fas fa-ban"></i>Atenção!</h5>
        <p class="font-weight-bold">
            {{ error_mensagem }}
        </p>
    </div>
    {% endif %}

    <!-- FILTROS -->
    <div class="row">
        <h5 class="font-weight-bold">Filtros</h5>
    </div>
    <form action="." method="get">
        <div class="row">
            <div class="col-12 col-sm-12 col-md-4">
                <select class="browser-default custom-select" id="ano" name="ano">
                    <option selected value="">Ano</option>
                    <option value="2020">2020</option>
                    <option value="2019">2019</option>
                </select>
            </div>
            <div class="col-12 col-sm-12 col-md-4">
                <select class="browser-default custom-select" id="mes" name="mes">
                    <option selected value="">Mês</option>
                    <option value="1">01</option>
                    <option value="2">02</option>
                    <option value="3">03</option>
                    <option value="4">04</option>
                    <option value="5">05</option>
                    <option value="6">06</option>
                    <option value="7">07</option>
                    <option value="8">08</option>
                    <option value="9">09</option>
                    <option value="10">10</option>
                    <option value="11">11</option>
                    <option value="12">12</option>
                </select>
            </div>
            <div class="col-12 col-sm-12 col-md-2">
                <button type="submit" class="btn btn-info btn-block" name="filtrar" title="Filtrar" value="Filtrar">Filtrar</button>
            </div>
            <div class="col-12 col-sm-12 col-md-2">
                <button type="submit" class="btn btn-warning btn-block" name="limpar" title="Limpar filtros" value="Limpar">Limpar</button>
            </div>
        </div>
    </form><br>

    <!-- MÉTRICAS -->
    <div class="row">
        <!-- MÉTRICAS DE CRÉDITOS -->
        <div class="col-12 col-sm-12 col-md-12">
            <span>Métricas creditos</span>
        </div>
        <!-- CRÉDITOS COMPRADOS  -->
        <div class="col-12 col-sm-6 col-md-3">
            <div class="info-box">
                <span class="info-box-icon bg-gradient-info elevation-1"><i class="fas fa-credit-card"></i></span>

                <div class="info-box-content">
                    <span class="info-box-text">Comprados</span>
                    <span class="info-box-number">
                        R$ {{ sum_valor_entradas|default_if_none:"0.00" }}
                    </span>
                </div>
            </div>
        </div>
        
        <!-- CŔEDITOS EM CARTEIRA -->
        <div class="col-12 col-sm-6 col-md-3">
            <div class="info-box">
                <span class="info-box-icon bg-gradient-info elevation-1"><i class="fas fa-wallet"></i></span>

                <div class="info-box-content">
                    <span class="info-box-text">Em carteira</span>
                    <span class="info-box-number">
                        R$ {{ sum_valor_carteira|default_if_none:"0.00" }}
                    </span>
                </div>
            </div>
        </div>
        
        <!-- CRÉDITOS UTILIZADOS -->
        <div class="col-12 col-sm-6 col-md-3">
            <div class="info-box">
                <span class="info-box-icon bg-gradient-info elevation-1"><i class="fas fa-check"></i></span>

                <div class="info-box-content">
                    <span class="info-box-text">Utilizados</span>
                    <span class="info-box-number">
                        R$ {{ sum_valor_saidas|default_if_none:"0.00" }}
                    </span>
                </div>
            </div>
        </div>
        
        <!-- MÉTRICAS DE PARADAS -->
        <div class="col-12 col-sm-12 col-md-12">
            <span>Métricas de paradas</span>
        </div>

        <!-- TOTAL PARADAS -->
        <div class="w-100"></div>
        <div class="col-12 col-sm-6 col-md-3">
            <div class="info-box">
                <span class="info-box-icon bg-info elevation-1"><i class="fas fa-car"></i></span>

                <div class="info-box-content">
                    <span class="info-box-text">Total de paradas</span>
                    <span class="info-box-number">
                        {{ sum_total_paradas|default_if_none:"0.00" }}
                    </span>
                </div>
            </div>
        </div>

        <!-- PARADA ATIVAS -->
        <div class="col-12 col-sm-6 col-md-3">
            <div class="info-box">
                <span class="info-box-icon bg-info elevation-1"><i class="fas fa-car-side"></i></span>

                <div class="info-box-content">
                    <span class="info-box-text">Total de paradas ativas</span>
                    <span class="info-box-number">
                        {{ sum_total_paradas_ativas|default_if_none:"0.00" }}
                    </span>
                </div>
            </div>
        </div>

        <!-- TOTAL DE NOTIFICAÇÕES -->
        <div class="w-100"></div>
        <div class="col-12 col-sm-6 col-md-3">
            <div class="info-box">
                <span class="info-box-icon bg-gradient-gray elevation-1"><i class="fas fa-exclamation"></i></span>

                <div class="info-box-content">
                    <span class="info-box-text">Total de notificações</span>
                    <span class="info-box-number">
                        {{ sum_total_notificacoes|default_if_none:"0.00" }}
                    </span>
                </div>
            </div>
        </div>
        
        <!-- TAXA DE NOTIFICAÇÕES -->
        <div class="col-12 col-sm-6 col-md-3">
            <div class="info-box">
                <span class="info-box-icon bg-gradient-gray elevation-1"><i class="fas fa-exclamation"></i></span>

                <div class="info-box-content">
                    <span class="info-box-text">Taxa de notificações</span>
                    <span class="info-box-number">
                        {{ taxa_notificacoes|default_if_none:"0.00" }}<small>%</small>
                    </span>
                </div>
            </div>
        </div>

        <!-- TOTAL DE INFRAÇOES -->
        <div class="col-12 col-sm-6 col-md-3">
            <div class="info-box">
                <span class="info-box-icon bg-gradient-gray elevation-1"><i class="fas fa-exclamation-triangle"></i></span>

                <div class="info-box-content">
                    <span class="info-box-text">Total de infrações</span>
                    <span class="info-box-number">
                        {{ sum_total_infracoes|default_if_none:"0.00" }}
                    </span>
                </div>
            </div>
        </div>

        <!-- TAXA DE INFRAÇÕES -->
        <div class="col-12 col-sm-6 col-md-3">
            <div class="info-box">
                <span class="info-box-icon bg-gradient-gray elevation-1"><i class="fas fa-exclamation-triangle"></i></span>

                <div class="info-box-content">
                    <span class="info-box-text">Taxa de infrações</span>
                    <span class="info-box-number">
                        {{ taxa_infracoes|default_if_none:"0.00" }}<small>%</small>
                    </span>
                </div>
            </div>
        </div>

         <!-- MÉTRICAS DE DESEMPENHO/mês -->
         <div class="col-12 col-sm-12 col-md-12">
            <span>Métricas de desempenho/mês</span>
        </div>

        <!--  -->
        <div class="w-100"></div>
        <div class="col-12 col-sm-6 col-md-3">
            <div class="info-box">
                <span class="info-box-icon bg-gradient-gray-dark elevation-1"><i class="fas fa-thumbs-up"></i></span>

                <div class="info-box-content">
                    <span class="info-box-text">Total de horas válidas</span>
                    <span class="info-box-number">
                        {{ horas_validas|default_if_none:"0.00" }}<small>h</small>
                    </span>
                </div>
            </div>
        </div>

        <!--  -->
        <div class="col-12 col-sm-6 col-md-3">
            <div class="info-box">
                <span class="info-box-icon bg-gradient-gray-dark elevation-1"><i class="fas fa-chart-bar"></i></span>

                <div class="info-box-content">
                    <span class="info-box-text">Total de horas válidas usadas</span>
                    <span class="info-box-number">
                        {{ total_horas_paradas|default_if_none:"0.00" }}<small>h</small>
                    </span>
                </div>
            </div>
        </div>

        <!--  -->
        <div class="col-12 col-sm-6 col-md-3">
            <div class="info-box">
                <span class="info-box-icon bg-gradient-gray-dark elevation-1"><i class="fas fa-asterisk"></i></span>

                <div class="info-box-content">
                    <span class="info-box-text">Delta</span>
                    <span class="info-box-number">
                        {{ delta_horas_paradas|default_if_none:"0.00" }}<small>h</small>
                    </span>
                </div>
            </div>
        </div>
    </div>


    <!-- GRAFICOS -->
    <div class="row">
        <!-- GRÁFICOS DE  -->
        <div class="col-12 col-sm-12 col-md-12">
            <span>Gráficos de totais</span>
        </div>
        <!-- CRÉDITOS COMPRADOS  -->
        <div class="col-12 col-sm-6 col-md-3">
        </div>
    </div>

    <style>
        #chartdiv {
            width: 100%;
            height: 500px;
        }
    </style>

    <!--
        Gráficos:
        * Gráfico de totais de paradas/infrações por setor;
        * Gráfico histórico de paradas/infrações;
        * Gráfico de total de vendas por região;
        * Top funcionários (vendas / buscas);
    -->
    <div id="chartdiv"></div>

{% endblock %}

{% comment %} BLOCO DE SCPRITS {% endcomment %}
{% block script %}
<script>
    am4core.ready(function () {

        // Themes begin
        am4core.useTheme(am4themes_animated);
        // Themes end

        // Create chart instance
        var chart = am4core.create("chartdiv", am4charts.XYChart);

        // Add data
        chart.data = [
            { date: new Date(2019, 5, 12), value1: 50, value2: 48, previousDate: new Date(2019, 5, 5) },
            { date: new Date(2019, 5, 13), value1: 53, value2: 51, previousDate: new Date(2019, 5, 6) },
            { date: new Date(2019, 5, 14), value1: 56, value2: 58, previousDate: new Date(2019, 5, 7) },
            { date: new Date(2019, 5, 15), value1: 52, value2: 53, previousDate: new Date(2019, 5, 8) },
            { date: new Date(2019, 5, 16), value1: 48, value2: 44, previousDate: new Date(2019, 5, 9) },
            { date: new Date(2019, 5, 17), value1: 47, value2: 42, previousDate: new Date(2019, 5, 10) },
            { date: new Date(2019, 5, 18), value1: 59, value2: 55, previousDate: new Date(2019, 5, 11) }
        ]

        // Create axes
        var dateAxis = chart.xAxes.push(new am4charts.DateAxis());
        dateAxis.renderer.minGridDistance = 50;

        var valueAxis = chart.yAxes.push(new am4charts.ValueAxis());

        // Create series
        var series = chart.series.push(new am4charts.LineSeries());
        series.dataFields.valueY = "value1";
        series.dataFields.dateX = "date";
        series.strokeWidth = 2;
        series.minBulletDistance = 10;
        series.tooltipText = "[bold]{date.formatDate()}:[/] {value1}\n[bold]{previousDate.formatDate()}:[/] {value2}";
        series.tooltip.pointerOrientation = "vertical";

        // Create series
        var series2 = chart.series.push(new am4charts.LineSeries());
        series2.dataFields.valueY = "value2";
        series2.dataFields.dateX = "date";
        series2.strokeWidth = 2;
        series2.strokeDasharray = "3,4";
        series2.stroke = series.stroke;

        // Add cursor
        chart.cursor = new am4charts.XYCursor();
        chart.cursor.xAxis = dateAxis;

    }); // end am4core.ready()
</script>
{% endblock %}